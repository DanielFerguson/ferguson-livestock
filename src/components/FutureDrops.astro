---

---

<section id="future-drops" class="py-24 bg-cream-dark">
    <div class="max-w-2xl mx-auto px-6">
        <div class="text-center mb-10">
            <span class="inline-block text-xs font-semibold uppercase tracking-widest text-sage mb-4">
                Future Box Drops
            </span>
            <h2 class="font-display text-3xl md:text-4xl font-semibold text-forest mb-4 tracking-tight">
                Not ready to order?
            </h2>
            <p class="text-lg text-gray-500">
                Join our list to be notified of future box drops and exclusive offers
            </p>
        </div>

        <div class="bg-white rounded-2xl p-8 md:p-10 shadow-lg shadow-forest/5 border border-cream-dark">
            <form id="future-drops-form">
                <div class="grid md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label
                            class="block text-xs font-semibold text-forest mb-1.5 uppercase tracking-wide"
                            for="futureFirstName">First Name</label
                        >
                        <input
                            type="text"
                            id="futureFirstName"
                            name="firstName"
                            required
                            autocomplete="given-name"
                            class="w-full px-4 py-3 border-2 border-cream-dark rounded-lg text-base bg-white transition-all duration-300 focus:outline-none focus:border-mint focus:ring-4 focus:ring-mint/15"
                            placeholder="Your first name"
                        />
                    </div>
                    <div>
                        <label
                            class="block text-xs font-semibold text-forest mb-1.5 uppercase tracking-wide"
                            for="futurePhone">Phone Number</label
                        >
                        <input
                            type="tel"
                            id="futurePhone"
                            name="phone"
                            required
                            autocomplete="tel"
                            class="w-full px-4 py-3 border-2 border-cream-dark rounded-lg text-base bg-white transition-all duration-300 focus:outline-none focus:border-mint focus:ring-4 focus:ring-mint/15"
                            placeholder="0412 345 678"
                        />
                    </div>
                    <div>
                        <label
                            class="block text-xs font-semibold text-forest mb-1.5 uppercase tracking-wide"
                            for="futurePostcode">Postcode</label
                        >
                        <input
                            type="text"
                            id="futurePostcode"
                            name="postcode"
                            required
                            autocomplete="postal-code"
                            pattern="[0-9]{4}"
                            maxlength="4"
                            inputmode="numeric"
                            class="w-full px-4 py-3 border-2 border-cream-dark rounded-lg text-base bg-white transition-all duration-300 focus:outline-none focus:border-mint focus:ring-4 focus:ring-mint/15"
                            placeholder="3350"
                        />
                    </div>
                </div>
                <button
                    type="submit"
                    class="w-full py-4 px-8 bg-forest text-cream rounded-lg text-base font-semibold uppercase tracking-wider transition-all duration-300 hover:bg-sage hover:-translate-y-0.5 hover:shadow-xl hover:shadow-forest/30 cursor-pointer border-0"
                    >Notify Me of Future Drops</button
                >
            </form>
            <div
                class="flex items-center justify-center gap-2 mt-5 text-sm text-gray-500"
            >
                <svg class="w-4 h-4 fill-sage" viewBox="0 0 24 24"
                    ><path
                        d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"
                    ></path></svg
                >
                No spam, ever. Unsubscribe anytime.
            </div>
        </div>
    </div>
</section>

<script>
    // Declare gtag, posthog, and fbq as global (loaded in Layout)
    declare const gtag: (...args: any[]) => void;
    declare const posthog:
        | {
              capture: (
                  event: string,
                  properties?: Record<string, any>,
              ) => void;
          }
        | undefined;
    declare const fbq: (...args: any[]) => void;

    // Track form start when user focuses on first field
    let futureFormStarted = false;
    document.getElementById("futureFirstName")?.addEventListener("focus", () => {
        if (!futureFormStarted) {
            futureFormStarted = true;
            if (typeof gtag === "function") {
                gtag("event", "form_start", {
                    form_id: "future-drops-form",
                    form_location: "future-drops",
                });
            }
            if (typeof posthog !== "undefined") {
                posthog.capture("form_started", {
                    form_id: "future-drops-form",
                    form_location: "future-drops",
                });
            }
        }
    });

    // Track ViewContent when form scrolls into view
    const futureDropsSection = document.getElementById("future-drops");
    if (futureDropsSection && typeof fbq === "function") {
        const observer = new IntersectionObserver(
            (entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        fbq("track", "ViewContent", {
                            content_name: "Future Drops Form",
                            content_category: "Lead Form",
                        });
                        observer.disconnect();
                    }
                });
            },
            { threshold: 0.5 },
        );
        observer.observe(futureDropsSection);
    }

    document
        .getElementById("future-drops-form")
        ?.addEventListener("submit", async function (e) {
            e.preventDefault();
            const form = e.target as HTMLFormElement;
            const submitButton = form.querySelector(
                'button[type="submit"]',
            ) as HTMLButtonElement;
            const firstName = (
                document.getElementById("futureFirstName") as HTMLInputElement
            )?.value;
            const phone = (
                document.getElementById("futurePhone") as HTMLInputElement
            )?.value;
            const postcode = (
                document.getElementById("futurePostcode") as HTMLInputElement
            )?.value;

            // Disable button and show loading state
            if (submitButton) {
                submitButton.disabled = true;
                submitButton.textContent = "Saving...";
            }

            try {
                const response = await fetch("/api/subscribe", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ firstName, phone, postcode }),
                });

                const result = await response.json();

                if (result.success) {
                    // Track successful lead generation
                    if (typeof gtag === "function") {
                        gtag("event", "generate_lead", {
                            postcode: postcode,
                            form_location: "future-drops",
                        });
                    }
                    if (typeof posthog !== "undefined") {
                        posthog.capture("form_submitted", {
                            form_id: "future-drops-form",
                            form_location: "future-drops",
                            postcode: postcode,
                        });
                    }
                    // Redirect to thank you page
                    window.location.href = `/thank-you?name=${encodeURIComponent(firstName)}`;
                } else {
                    // Show error message
                    alert(
                        result.error ||
                            "Something went wrong. Please try again.",
                    );
                    if (submitButton) {
                        submitButton.disabled = false;
                        submitButton.textContent = "Notify Me of Future Drops";
                    }
                }
            } catch (error) {
                console.error("Submit error:", error);
                alert("Something went wrong. Please try again.");
                if (submitButton) {
                    submitButton.disabled = false;
                    submitButton.textContent = "Notify Me of Future Drops";
                }
            }
        });
</script>
